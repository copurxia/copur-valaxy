---
title: ä»é›¶å¼€å§‹åˆ¶ä½œä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨
tags:
  - åˆ†äº«
  - ç¼–ç¨‹
author: ä¹å¾—è‡ªåœ¨
date: 2020-11-14 18:20:37
updated: 2020-11-14 18:20:37
---

## èµ·å› 
å…³äºä¸ºå•¥è¦åšè¿™ä¸ªéŸ³ä¹æ’­æ”¾å™¨ã€‚è¿™æœ‰å¥½å¤šåŸå› ï¼Œæœ€é‡è¦çš„è‡ªç„¶æ˜¯å› ä¸ºæƒ³å¬æ­Œï¼Œä½†æ˜¯ç½‘æ˜“å®˜æ–¹çš„å®¢æˆ·ç«¯åœ¨æ’­æ”¾çš„æ—¶å€™ç”¨ç€ä¸é¡ºæ‰‹ï¼Œå¦å¤–ï¼Œæ„Ÿè§‰å®˜æ–¹çš„å®¢æˆ·ç«¯åŠŸèƒ½å¯¹æˆ‘æ¥è¯´å®åœ¨å¤ªå¤šåŠŸèƒ½äº†ï¼Œè®¸å¤šåŠŸèƒ½æˆ‘å®é™…ä¸Šæ˜¯ç”¨ä¸åˆ°çš„ï¼Œäºæ˜¯æƒ³åŠ¨æ‰‹å¼€å§‹å†™ä¸€ä¸ªåˆè‡ªå·±å¿ƒæ„çš„æ’­æ”¾å™¨ã€‚å…¶æ¬¡[@xinda](https://xinda233.top/)çš„inné¡¹ç›®ç»™äº†æˆ‘å¾ˆå¤šå¯å‘ï¼Œå› æ­¤åŠ¨ç¬”å¼€å·¥ã€‚

<!-- more -->

### ä¸ºå•¥ç™¾åº¦è½»å’•äº†ï¼Ÿ

æ­¥å…¥é«˜ä¸‰ï¼Œå¾ˆå¤šæ—¶å€™çš„éƒ½èº«ä¸ç”±å·±ï¼Œå› æ­¤è¿™ä¸ªé¡¹ç›®ææ€•ä¹‹åä¹Ÿæ— æ³•æŒç»­æ›´æ–°ã€‚

## å‡†å¤‡

æ€è€ƒå†ä¸‰ï¼Œæš‚æ—¶ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ—¶é—´å­¦ä¹ æ–°ä¸œè¥¿ï¼Œäºæ˜¯å†³å®šä½¿ç”¨è‡ªå·±æš‚æ—¶æœ€é¡ºæ‰‹çš„[electron](https://electronjs.org)åŠ ä¸Šæ¨èç»™[@xinda233](https://xinda233.top/)ç”¨çš„[NeteaseCloudMusicApi](https://binaryify.github.io/NeteaseCloudMusicApi/)ï¼Œå‚è€ƒ[Ant Design](https://ant.design/docs/spec/introduce-cn)ä¸ºè®¾è®¡æ ‡å‡†ï¼Œå·®ä¸å¤šä¹Ÿä¸‡äº‹ä¿±å¤‡äº†

é…è‰²ç³»ç»Ÿï¼š [Muzli Colors](https://colors.muz.li/)
APIï¼š [NeteaseCloudMusicApi](https://binaryify.github.io/NeteaseCloudMusicApi/)
UIåº“ï¼š [electron](https://electronjs.org)
è¯­è¨€ï¼š [NodeJS](https://nodejs.org/)

## ç¯å¢ƒæ­å»º

1. é¦–å…ˆå®‰è£…[nodejs](https://nodejs.org/)ç¯å¢ƒï¼Œæ¯•ç«Ÿä¸æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨nodeï¼Œè¿™ä¸ªæ—©æ—©å‡†å¤‡å¥½äº†ã€‚
2. æ¥ç€å®‰è£…electronï¼Œå› ä¸ºæˆ‘è¿˜ä¸ä¼šä½¿ç”¨electron-builderï¼Œè€Œä¸”ä¸ºäº†å‡å°‘é¡¹ç›®æ–‡ä»¶å¤¹ä½“ç§¯ï¼Œé€‰æ‹©å…¨å±€å®‰è£… `npm install electron -g` 
3. æ‰§è¡Œ` md codemusic ; cd codemusic ; npm init`æ–°å»ºå¼€å‘é¡¹ç›®ï¼ˆç°åœ¨åœ¨Windowsç¯å¢ƒä¸‹ï¼‰

![1.png](https://img13.360buyimg.com/ddimg/jfs/t1/135134/33/16034/66546/5fafc33eEbadef6c8/9331f90a7ba20fb8.png)

4. æ–°å»ºå®Œ`index.js`å’Œ`index.html`ç•Œé¢å¦‚å›¾æ‰€ç¤º

![1.png](https://img13.360buyimg.com/ddimg/jfs/t1/141925/5/14574/147088/5fafc755E5fd8c778/9dacdce40a1463eb.png)

5. åˆ°æ­¤ï¼Œä¸€ä¸ªåŸºæœ¬çš„electronå¼€å‘ç¯å¢ƒå‡†å¤‡å®Œæˆ
6. å¦å¤–ï¼Œè®°å¾—æŠŠ`powershell`è®¾ç½®ä¸º`utf-8`å‚è€ƒ[https://www.zhihu.com/question/54724102](https://www.zhihu.com/question/54724102)

## æ­£å¼å¼€å§‹

### åšå¥½ä¸€ä¸ªçª—ä½“

é¦–å…ˆæˆ‘éœ€è¦æ˜ç¡®è‡ªå·±éœ€è¦ä»€ä¹ˆï¼Œæ ¹æ®å·²æœ‰çš„è®¾è®¡ï¼Œç•Œé¢ä¸»è¦éƒ¨åˆ†æ˜¯ä¸€ä¸ªåœ†å½¢çª—ä½“åŠ ä¸Šç¯ç»•çª—ä½“çš„ç¯çŠ¶è¿›åº¦æ¡

å› æ­¤ï¼Œæˆ‘ä¸éœ€è¦èœå•æ ï¼Œçª—ä½“æ¡†æ¶ï¼Œè€Œä¸”è¿™å¿…é¡»æ˜¯ä¸ªä¸å¯èšç„¦ä¸”ä¸å¯æ”¹å˜å¤§å°çš„ç½®é¡¶çª—å£

å› æ­¤æˆ‘è®¾ç½®å¦‚ä¸‹å±æ€§

```json
    focusable: false,
    alwaysOnTop: true,
    frame:false,
    transparent: true, 
	resizable: false
```

è®©æˆ‘ä»¬æ¥è¯•ç€è¿è¡Œâ€¦â€¦

ç¥å¥‡çš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå› ä¸ºæˆ‘ä»¬çš„çª—ä½“å†…éƒ¨è¿˜æ²¡æœ‰ç»˜åˆ¶ä»»ä½•ä¸œè¥¿ï¼Œæ‰€ä»¥é©¬ä¸Šå¼€å§‹è¿è¡Œè‡ªç„¶åªæ˜¯å‘è‡ªå·±

å› ä¸ºè¿è¡Œæ—¶å‡ºç°äº†æ»šåŠ¨æ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨cssç§»é™¤å®ƒ

```css
body {
  overflow-x: hidden;
  overflow-y: hidden;
  -webkit-app-region: drag;
}
```

### ç¯å½¢è¿›åº¦æ¡

è¿›åº¦æ¡è¿™ä¸œè¥¿ä¹Ÿä¸æ˜¯ç¬¬ä¸€æ¬¡åšï¼Œè¯¦ç»†å¯ä»¥å‚è€ƒæˆ‘[ä¹‹å‰çš„æ–‡ç« ](https://copur.xyz/post/progressbar/)

ä½†æ˜¯ç›´çº¿è¿›åº¦æ¡å˜ä¸ºç¯å½¢ä¼¼ä¹å¯¼è‡´äº†å¤§è„‘å®•æœºï¼Œæ¯•ç«Ÿæˆ‘çš„cssçŸ¥è¯†æå…¶è–„å¼±

äºæ˜¯ä¸€ç¿»æ”¶è—å¤¹ï¼Œæ‰¾å›Ant Designé‡Œçš„è¿›åº¦æ¡ï¼Œåˆå»æ˜é‡‘æ‰¾äº†ç¯‡æ–‡ç« [ã€Šcss3 åˆ¶ä½œåœ†ç¯è¿›åº¦æ¡ã€‹](https://juejin.im/post/6844903556164616205),ä»¥åŠç®€ä¹¦çš„[ã€Šåˆ©ç”¨ clip-path å®ç°ç¯å½¢è¿›åº¦æ¡ã€‹](https://www.jianshu.com/p/bc94380c4a22)ï¼Œæ¯”è¾ƒè¿‡åå†³å®šè¿˜æ˜¯ä½¿ç”¨svgæ–¹æ¡ˆã€‚æ¯•ç«Ÿä½¿ç”¨ç¯å¢ƒä¸ºelectronï¼Œè€Œcsså®ç°åˆè¿‡äºéº»çƒ¦ï¼Œå°½ç®¡ä¹‹å‰æœ‰åšè¿‡[csså¤§åœ†æ—‹è½¬](https://copur.xyz/englisten/)ï¼Œä½†ä¹Ÿæ­£æ˜¯å› ä¸ºä»¥å‰åšè¿‡ï¼Œæ‰€ä»¥å†ä¹Ÿä¸æƒ³è¸©è¿›è¿™ä¸ªå‘äº†ã€‚

åœ¨ä¸€é€šæŠ˜è…¾åï¼Œæ€»ç®—å‚è€ƒ[ã€Šhtml svgç”Ÿæˆç¯å½¢è¿›åº¦æ¡çš„å®ç°æ–¹æ³•ã€‹](https://www.jb51.net/html5/694584.html)å®Œæˆäº†

![1.png](https://img10.360buyimg.com/ddimg/jfs/t1/122472/12/18581/140702/5fafd5c0Ed12d84af/78be7bf6bc99e683.png)

æŠŠ[ã€Šhtml svgç”Ÿæˆç¯å½¢è¿›åº¦æ¡çš„å®ç°æ–¹æ³•ã€‹](https://www.jb51.net/html5/694584.html)ä¸­çš„`js`æ§åˆ¶ä»£ç æ”¹ä¸º

```javascript
let path = document.querySelector('.progress');
let len = path.getTotalLength(); //æœ€å¤§é•¿åº¦
path.style.strokeDashoffset = "300px"; #ä¸º471pxå‡å»æ‰€éœ€ç™¾åˆ†æ¯”ï¼Œè§åæ–‡
```

### è¿æ¥ç½‘æ˜“äº‘

æŒ‰ç…§å·²æœ‰çš„è®¾è®¡ï¼Œè¿æ¥ç½‘æ˜“çš„éƒ¨åˆ†ä¸ä½¿ç”¨åŸç”ŸAPIå®ç°ï¼Œè½¬è€Œä½¿ç”¨[Binaryify/NeteaseCloudMusicApi](https://github.com/Binaryify/NeteaseCloudMusicApi)

#### è¿æ¥å‡†å¤‡

1. å°†[Binaryify/NeteaseCloudMusicApi](https://github.com/Binaryify/NeteaseCloudMusicApi)ç›®å½•ä¸‹çš„`plugins`ã€`util`ã€`module`æ–‡ä»¶å¤¹å’Œ`main.js`æ–‡ä»¶æ‹·è´åˆ°é¡¹ç›®ç›®å½•ä¸‹

2. å®‰è£…æ¨¡å—

```shell
npm install asios --save
npm install pac-proxy-agent --save
npm install tunnel --save
```

### å¼€å§‹è¿æ¥

#### æ¨¡å—æ€ä¹ˆå¼•ç”¨

é¦–å…ˆä»¥æ­Œå•è¯¦æƒ…å’Œæ­Œå•urlä¸ºä¾‹

![ov30a.png](https://img.maocdn.cn/img/2020/11/28/ov30a.png)

![ovIKK.png](https://img.maocdn.cn/img/2020/11/28/ovIKK.png)

ç”±å®˜ç½‘ç»™å‡ºçš„è¯·æ±‚åœ°å€ï¼Œå†ç»“åˆmodelä¸‹æ–‡ä»¶åå¯å¾—

éœ€è¦å¼•ç”¨çš„æ¨¡å—åå¦‚ `/playlist/detail` æ¨¡å—åä¸º `playlist_detail`

æ•…å¾—ä»£ç å¦‚ä¸‹

```js
const {
    playlist_detail,
    song_url,
} = require('./main')
async function test() {
    try {
        const result = await playlist_detail({
                id: 5334910692,
            })
        console.log(result.body.playlist)
        const result4 = await song_url({
            cookie: result.body.cookie,
            id: 22699108,
        })
        console.log(result4.body)

    } catch (error) {
        console.log(error)
    }
}
test()
```

å¾—åˆ°æ ¼å¼åŒ–å‡ºæ¥çš„ä»£ç 

![oyM1N.png](https://img.maocdn.cn/img/2020/11/28/oyM1N.png)

![ovCwS.png](https://img.maocdn.cn/img/2020/11/28/ovCwS.png)

ç»“åˆæ–‡æ¡£çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“çœ‹å‡ºï¼Œéœ€è¦çš„æ­Œæ›²IDæ•°æ®åº”åœ¨`result.body.playlist.trackIds`ä¸­

### jsæ§åˆ¶audio

å‚ç…§[HTML DOM Audio å¯¹è±¡](https://www.w3school.com.cn/jsref/dom_obj_audio.asp)

å®šä¹‰ä¸€ä¸ªaudioæ ‡ç­¾

```html
<audio src="b.mp3" controls="controls" preload id="music" hidden>
```

æ’­æ”¾ï¼š`DOM.play()`

æš‚åœï¼š`DOM.pause()`

æ˜¯å¦æš‚åœï¼š`DOM.paused` æš‚åœè¿”å›trueï¼Œå¦åˆ™è¿”å›false

æ—¶é—´æ§åˆ¶ï¼š`DOM.currentTime`èµ‹å€¼æ§åˆ¶ï¼Œè¯»å€¼è¯»å–ï¼Œä»¥ç§’è®¡

æ€»æ—¶é•¿ï¼š`DOM.duration` ä»¥ç§’è®¡

### å®æ—¶æ›´æ–°è¿›åº¦æ¡è¿›åº¦

```javascript
path = document.querySelector('.progress');
audio = document.getElementById('music');
async function interv() {
    setInterval(function() {
        path.style.strokeDashoffset = parseInt(471 * (1 - audio.currentTime / audio.duration)).toString() + "px";
        console.log(path.style.strokeDashoffset)
    }, 100);
}

interv()
```



### ç”Ÿæˆæ’­æ”¾åˆ—è¡¨

é¦–å…ˆå®šä¹‰ä¸€ä¸ª`playlist`æ•°ç»„

ä½¿ç”¨`foreach`éå†è¿”å›çš„`result.body.playlist.trackIds`å°†å…¶æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨

```javascript
result = await playlist_detail({
    id: 5334910692,
})
//console.log(result.body.playlist.trackIds)
result.body.playlist.trackIds.forEach(function(element) {
//console.log(element.id);
var muinfor = {
    src: "",
    name: ""
}
muinfor.id = element.id
playlist.push(muinfor);
console.log(muinfor)
});
```

ä½†æ˜¯ï¼Œåœ¨è¿™ä¹‹åå‘ç°äº†ä¸€ä¸ªæ›´å‘çš„é—®é¢˜

æŠ¥é”™ä»£ç å¦‚ä¸‹

```powershell
var songcheck = await check_music(reqinfor)
                ^^^^^
SyntaxError: await is only valid in async function
    at wrapSafe (internal/modules/cjs/loader.js:1051:16)
    at Module._compile (internal/modules/cjs/loader.js:1101:27)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1166:10)
    at Module.load (internal/modules/cjs/loader.js:981:32)
    at Module._load (internal/modules/cjs/loader.js:881:14)
    at Function.Module._load (electron/js2c/asar.js:769:28)
    at loadApplicationPackage (C:\Users\19355\AppData\Roaming\npm\node_modules\electron\dist\resources\default_app.asar\main.js:109:16)
    at Object.<anonymous> (C:\Users\19355\AppData\Roaming\npm\node_modules\electron\dist\resources\default_app.asar\main.js:155:9)
    at Module._compile (internal/modules/cjs/loader.js:1145:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1166:10)
```

å‚è€ƒ[ã€Šåœ¨foreachä¸­ä½¿ç”¨async/awaitçš„é—®é¢˜ã€‹](https://blog.csdn.net/yumikobu/article/details/84639025)åï¼Œå‘ç°è¿™æ˜¯foreachå¯¼è‡´çš„å‘ï¼Œä¸€é€šåˆ†æä¸‹æ¥ï¼Œå¤§è‡´èƒ½å¤Ÿæ”¹ä¸º

```javascript
result = await playlist_detail({
    id: 5334910692,
})
//console.log(result.body.playlist.trackIds)
result.body.playlist.trackIds.forEach(async function(element) {
//console.log(element.id);
var muinfor = {
    src: "",
    name: ""
}
muinfor.id = element.id
playlist.push(muinfor);
console.log(muinfor)
});
```

### è·å–æ­Œæ›²è¯¦æƒ…

```javascript
const result5 = await song_detail({
    ids: "347230,347231",
})
console.log(result5.body)
```

å¾—è¿”å›ç»“æœ
![1c83703e58f81c42f.png](https://img.maocdn.cn/img/2020/11/28/1c83703e58f81c42f.png)]

åˆ†æåå‘ç°æ˜¯ä¸­æ–‡ç¼–ç é—®é¢˜ï¼Œå› æ­¤å°†æ­Œæ›²åä½œä¸ºbase64ç¼–ç 

```javascript
let reqinfor = {}
reqinfor.ids = String(element.id)
let result5 = await song_detail(reqinfor)
Buffer.from(result5.body.songs[0].name).toString('base64')
```

#### æ­Œæ‰‹

```javascript
let author = []
result5.body.songs[0].ar.forEach(function(element) {
    let author_infor = {}
    author_infor.name = Buffer.from(element.name).toString('base64')
    author_infor.id = element.id
    author.push(author_infor)
})
muinfor[index].author = author
```

ä»”ç»†æ€è€ƒåå‘ç°è¿˜æ˜¯ä¸è¦ä½¿ç”¨base64ç¼–ç ï¼Œä¸ç„¶æ–‡ä»¶é‡Œé¢ä¸€ç‰‡ä¹±

#### ä¸“è¾‘ä¿¡æ¯

```javascript
let al = {}
al.name = result5.body.songs[0].al.name
al.pic = result5.body.songs[0].al.picUrl
al.id = result5.body.songs[0].al.id
muinfor[index].al = al
```

#### æ±‡æ€»

##### è·å–æ­Œæ›²ä¿¡æ¯

```javascript
async function getncminfor(id) {
    let muinfor = {}
    muinfor.id = id
    muinfor.type = "ncm"
    let reqinfor = {}
    reqinfor.ids = String(element.id)
    let result5 = await song_detail(reqinfor)
    muinfor.name = result5.body.songs[0].name
    let author = []
    result5.body.songs[0].ar.forEach(function(element) {
        let author_infor = {}
        author_infor.name = element.name
        author_infor.id = element.id
        author.push(author_infor)
    })
    muinfor.author = author
    let al = {}
    al.name = result5.body.songs[0].al.name
    al.pic = result5.body.songs[0].al.picUrl
    al.id = result5.body.songs[0].al.id
    muinfor.al = al
    return muinfor
}
```

##### ä¿å­˜è®¾ç½®

````javascript
function saveset() {
    console.log(playlist)
    let yamlStr = yaml.dump(playlist);
    fs.writeFileSync('playlist.yaml', yamlStr, 'utf8');
    yamlStr = yaml.dump(setda);
    fs.writeFileSync('setda.yaml', yamlStr, 'utf8');
}
````

##### è·å–æ­Œæ›²URL

```javascript
async function getncmurl(id) {
    try {
        let req = {}
        let ncmurl
        req.id = id
        var songcheck = await check_music(req)
            //console.log(songcheck.body.message)
        if (songcheck.body.success) {
            let result4 = await song_url(req)
                //console.log(reqinfor[index])
            console.log(result4.body.data[0].url)
            ncmurl = result4.body.data[0].url
        } else {
            console.log("No copyright")
        }
        return Promise.resolve(ncmurl)
    } catch (error) {
        console.log(error)
    }

}
```

##### è·å–æ­Œå•è¯¦æƒ…

```javascript
async function getncmlist(id) {
    let req = {}
    req.id = id
    result = await playlist_detail(req)
    let list = []
    result.body.playlist.trackIds.forEach(async function(element, index) {
        list[index] = element.id
    });
    return list
}
```



### ä½¿ç”¨yamlå­˜å‚¨æ’­æ”¾åˆ—è¡¨

é¦–å…ˆå®‰è£…

```bash
npm install js-yaml --save
```

å°†ç¨‹åºå†…çš„æ’­æ”¾åˆ—è¡¨è½½å…¥

```javascript
let playlistStr = yaml.dump(muinfor);
fs.writeFileSync('playlist.yaml', playlistStr, 'utf8');
```

å¾—åˆ°yamlæ–‡ä»¶

![1.png](https://img.maocdn.cn/img/2020/12/06/1.png)

### å‰åç«¯è¿æ¥

è™½ç„¶ç°åœ¨å‰ç«¯éƒ¨åˆ†å°šæœªå®Œæˆï¼Œä½†è²Œä¼¼å‰åç«¯è¿æ¥è¿˜æ˜¯æŒºé‡è¦çš„ï¼Œç½‘æ˜“çš„å®šæ—¶å¤±æ•ˆé“¾æ¥è°ƒè¯•çš„æ—¶å€™è¿˜æ˜¯æŒºéº»çƒ¦çš„

> ä¸çŸ¥ä¸è§‰åŠå¹´éƒ½è¿‡å»äº†ï¼Œè¿™ä¸ªé¡¹ç›®å’•å¾—æœ‰ç‚¹ä¹…äº†ï¼Œè¿˜æ˜¯å¾—è¡¥è¡¥         â€”â€”2021.4.17

#### ä½¿ç”¨websocket

è™½ç„¶`electron`æœ¬èº«æä¾›äº†`ipc`çš„é€šä¿¡æ–¹æ¡ˆï¼Œä½†å› ä¸ºæˆ‘ä»¥å‰å› ä¸ºä½¿ç”¨`ipc`ä¼ è¾“å¤§é‡æ•°æ®åé—ªé€€ï¼Œæ‰€ä»¥é€‰æ‹©ç›¸å¯¹æ›´ä¸ºç¨³å®šçš„`koa`+`websocket`æ–¹æ¡ˆ

##### å®‰è£…ä¾èµ–

```bash
npm install koa koa-route koa-websocket bufferutil utf-8-validate --save
```

##### å®ç°

åŸå‹æ¥è‡ª[nodejsä½¿ç”¨koa+websocketå®ç°ç‚¹å¯¹ç‚¹çš„å³æ—¶é€šè®¯](https://blog.csdn.net/qq_39425927/article/details/107975174)

å¥½åƒä¸€æ¨¡ä¸€æ ·æ¬¸ğŸ˜

###### æœåŠ¡ç«¯

```javascript
// ä½¿ç”¨koa
const koa = require('koa')
const router = require('koa-router')()
// koa-websocketæ˜¯koaå°è£…å¥½çš„websocketåŠŸèƒ½
const websocket = require('koa-websocket')
// å®ä¾‹åŒ–ä¸€ä¸ªwsæœåŠ¡
const app = websocket(new koa())

// ç”¨æ¥å­˜å‚¨å»ºç«‹äº†çš„é“¾æ¥ï¼Œï¼ˆçœŸå®é¡¹ç›®ä¸­è¯·ä½¿ç”¨æ•°æ®åº“ä»£æ›¿ï¼‰
let wsObj = {}

// ç›‘å¬koa/wsè·¯ç”±ï¼Œæ˜¯å¦æœ‰è¿æ¥
router.all('/koa/ws', (ctx) => {
    // å®¢æˆ·ç«¯é“¾æ¥ä¼ è¿‡æ¥çš„å®¢æˆ·ç«¯èº«ä»½
    const { id } = ctx.query
    // å°†é“¾æ¥ä¿å­˜èµ·æ¥
    wsObj[id] = ctx;
    // ç»™å®¢æˆ·ç«¯å‘é€é“¾æ¥æˆåŠŸä¿¡æ¯
    ctx.websocket.send('è¿æ¥æˆåŠŸ');
    // ç›‘å¬å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„ä¿¡æ¯
    ctx.websocket.on('message', function(message) {
        console.log(message);
        // uidä¸ºæ¥æ”¶æ–¹ï¼Œå°†æ¥æ”¶åˆ°çš„ä¿¡æ¯å‘é€ç»™æ¥æ”¶æ–¹uid,å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¤„ç†æ•°æ®å†å‘é€
        const uid = JSON.parse(message).uId;
        if(!wsObj[uid]){
            ctx.websocket.send(`${uid}æœªä¸Šçº¿`)
        }else{
            wsObj[uid].websocket.send(message)
        }
        
    });
})
// ä½¿ç”¨è·¯ç”±
app.ws.use(router.routes()).use(router.allowedMethods())

//ç«¯å£å·åé¢å¯é‡‡ç”¨åŠ¨æ€çš„
app.listen(3000, () =>
    console.log('æœåŠ¡å¯åŠ¨æˆåŠŸ')
)
```

æ•°æ®åº“å•¥çš„å°±ä¸è€ƒè™‘äº†ï¼Œåæ­£åªæ˜¯ç¨‹åºå‰åç«¯ä¹‹é—´çš„é€šä¿¡ï¼ˆè™½ç„¶å¥½åƒç¨‹åºå†…é€šä¿¡ç”¨`websocket`æŒºå¥‡æ€ªçš„ï¼‰

> åæ¥å‘ç°ï¼Œè¿™ç¯‡æ–‡ç« é‡Œçš„ç©æ„è¿˜æ˜¯æŒºå‘çš„ï¼Œä¼°è®¡æ˜¯koaé‚£è¾¹æ›´æ–°äº†
>
> äºæ˜¯æœ€åå‚è€ƒ[https://github.com/kudos/koa-websocket](https://github.com/kudos/koa-websocket)

###### å®¢æˆ·ç«¯

```javascript
//è¿æ¥åç«¯
let mId = "play"; // æˆ‘çš„id
let webs = new WebSocket('ws://localhost:3000/koa/ws?id=' + mId) //websocketå¯¹è±¡
webs.onopen = function () {
    console.log('è¿æ¥æˆåŠŸ')
}
// æ¥æ”¶æœåŠ¡å™¨å‘é€çš„ä¿¡æ¯
webs.onmessage = function (evt) {
    console.log(evt)
}

function wssend(id, content) {
    var data = {
        mId: mId,
        uId: id,
        content: content
    }
    webs.send(JSON.stringify(data))
}
```



### ä»yamlå†…åŠ è½½é…ç½®æ–‡ä»¶

```javascript
try {
    let fileContents = fs.readFileSync('./playlist.yaml', 'utf8');
    playlist = yaml.load(fileContents);
    console.log(playlist);
    fileContents = fs.readFileSync('./setda.yaml', 'utf8');
    setda = yaml.load(fileContents);
    console.log(setda);
} catch (e) {
    console.log("å¯åŠ¨å‡ºé”™")
    console.log(e);
}
```



## åç»­æ­¥éª¤

ç”±äºæ—¶é—´åŸå› ï¼Œæš‚æ—¶åœäºæ­¤å¤„ï¼Œæ—¥åå†æ›´