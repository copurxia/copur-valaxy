---
title: è¿œç¨‹æ¡Œé¢æœåŠ¡é…ç½®çš„éƒ¨åˆ†è®°å½•
date: 2022-06-2 14:12:28
tags: ["æœåŠ¡é…ç½®","RDP"]
categories: ["æ•™ç¨‹"]
---

# è¿œç¨‹æ¡Œé¢æœåŠ¡é…ç½®çš„éƒ¨åˆ†è®°å½•

å› å·¥ä½œå­¦ä¹ éœ€è¦ï¼Œæœ€è¿‘å’Œå®¤å‹åˆèµ„è´­å…¥äº†ä¸€å°ç”µè„‘ï¼Œä¸ºä¾¿äºä½¿ç”¨è¿›è¡Œrdpçš„é…ç½®

## RDPè¡¥å…¨å‡çº§

ä½¿ç”¨[SuperRDP2](https://www.hankeer.org/article/superrdp2.html)å¯¹Windowsç‰ˆæœ¬è¿›è¡Œè¡¥å…¨

åŒæ—¶åç»­çš„ç»„ç­–ç•¥ç›¸å…³å†…å®¹ï¼Œå»ºè®®ä½¿ç”¨ä¸“ä¸šç‰ˆ

åŸæœ¬å‚è€ƒä½¿ç”¨çš„æ˜¯[RDPWrap](https://github.com/stascorp/rdpwrap)ï¼Œä½†å› ä¸ºRDPWrapå·²ç»å¹´ä¹…å¤±ä¿®ï¼Œä¸”æ— æ³•åŠæ—¶é€‚é…æ–°ç‰ˆç‰ˆæœ¬ï¼Œä½¿ç”¨é¢æœ‰é™

<!-- more -->

SuperRDP2ä¸»è¦åŠŸèƒ½

1. æ‹‰å»çº¿ä¸Šæœ€æ–°é…ç½®ä¿¡æ¯ï¼Œè‡ªåŠ¨é‡è£…
2. å®æ—¶æ£€æŸ¥è¿œç¨‹æ¡Œé¢å¼€å¯çŠ¶æ€
3. **é«˜çº§åŠŸèƒ½ï¼šè‡ªåŠ¨åˆ†æ** 1ï¼‰æ”¯æŒè‡ªåŠ¨åˆ†ææœªæ”¯æŒç‰ˆæœ¬ï¼Œè‡ªåŠ¨æ”¯æŒã€‚ 2ï¼‰ç³»ç»Ÿå‡çº§åè‡ªåŠ¨åˆ†ææ”¯æŒæ–°ç‰ˆæœ¬ï¼ˆå¼€å¯è‡ªåŠ¨åˆ†æã€å¼€æœºå¯åŠ¨ï¼‰
4. å¤‡ä»½å½“å‰é…ç½®åˆ°SuperRDP2ç›®å½•å¹¶åˆ†äº«åˆ°GitHub

å…¶ä¸­è‡ªåŠ¨åˆ†æéœ€è¦ä½¿ç”¨ä½œè€…çš„å…¬ä¼—å·è·å–ä»£ç å¼€å¯

## å¼€å¯è¿œç¨‹æ¡Œé¢

> è¯·ç¡®ä¿ä½¿ç”¨çš„æ˜¯Windowsä¸“ä¸šç‰ˆï¼ˆæˆ–æ›´å®Œæ•´ç‰ˆæœ¬ï¼‰æˆ–è€…å·²ç»é€šè¿‡SuperRDP2è¿›è¡Œè¡¥å…¨

é€šè¿‡ç‚¹å‡»è®¾ç½® -> è¿œç¨‹æ¡Œé¢

![image-20220602135154850](../../public/image/image-20220602135154850.png)

éšåç‚¹å‡»ä¸‹æ–¹çš„`è¿œç¨‹æ¡Œé¢ç”¨æˆ·`æ·»åŠ èƒ½åŠ å…¥è¿œç¨‹æ¡Œé¢çš„ç”¨æˆ·

![image-20220602135319582](../../public/image/image-20220602135319582.png)

## è°ƒæ•´ç»„ç­–ç•¥

> æœ¬ç« èŠ‚éœ€è¦æœåŠ¡ç«¯ä¸ºä¸“ä¸šç‰ˆæˆ–æ›´å®Œæ•´ç‰ˆæœ¬

`Win+R` æ‰“å¼€è¿è¡Œï¼Œè¾“å…¥`gpedit.msc`ï¼Œæ‰“å¼€æœ¬åœ°ç»„ç­–ç•¥ç¼–è¾‘å™¨ï¼Œä¾æ¬¡é€‰æ‹©[è®¡ç®—æœºé…ç½®] --> [ç®¡ç†æ¨¡æ¿] --> [Windowsç»„ä»¶] --> [è¿œç¨‹æ¡Œé¢æœåŠ¡] --> [è¿œç¨‹ä¼šè¯ä¸»æœº] --> [è¿æ¥]

è°ƒæ•´å¦‚ä¸‹ç»„ç­–ç•¥

1. å¯ç”¨â€œé™åˆ¶è¿æ¥çš„æ•°é‡â€ï¼Œæ ¹æ®è‡ªå·±éœ€è¦è®¾ç½®æ•°é‡å®ç°å¤šç”¨æˆ·ç™»å½•

2. å¯ç”¨â€œå°†è¿œç¨‹æ¡Œé¢æœåŠ¡ç”¨æˆ·é™åˆ¶åˆ°å•ç‹¬çš„è¿œç¨‹æ¡Œé¢æœåŠ¡ä¼šè¯â€ï¼Œé¿å…ä¸€ä¸ªç”¨æˆ·å‡ºç°å¤šæ¬¡è¿æ¥å¯¼è‡´éƒ¨åˆ†ç¨‹åºæ— æ³•æ‰¾åˆ°

![image-20220602135902566](../../public/image/image-20220602135902566.png)

è¿”å›ä¸Šä¸€çº§ï¼Œé€‰æ‹©è¿œç¨‹ä¼šè¯ç¯å¢ƒ

è°ƒæ•´å¦‚ä¸‹ç»„ç­–ç•¥

- å¯ç”¨â€œå°†ç¡¬ä»¶å›¾å½¢é€‚é…å™¨åº”ç”¨äºæ‰€æœ‰è¿œç¨‹æ¡Œé¢æœåŠ¡ä¼šè¯â€ä»¥ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ

å¯ä»¥ä¸‹è½½[nvidia-opengl-rdp](https://developer.nvidia.com/nvidia-opengl-rdp)ä»¥å¯ç”¨nå¡çš„ç¡¬ä»¶åŠ é€Ÿ

æ­¤å¤„å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´æ›´å¤šç»„ç­–ç•¥ä»¥é€‚åº”éœ€æ±‚

![image-20220602140400224](../../public/image/image-20220602140400224.png)

å¯åœ¨ç”¨æˆ·æœºçš„ç»„ç­–ç•¥

[è®¡ç®—æœºé…ç½®] --> [ç®¡ç†æ¨¡æ¿] --> [Windowsç»„ä»¶] --> [è¿œç¨‹æ¡Œé¢æœåŠ¡] --> [è¿œç¨‹æ¡Œé¢è¿æ¥å®¢æˆ·ç«¯] --> [RemoteFX USBè®¾å¤‡é‡å®šå‘]

å¯ç”¨â€œå…è®¸æ­¤è®¡ç®—æœºä¸­æ‰‹æŒ‡æ“çš„å…¶ä»–RemoteFX USB è®¾å¤‡çš„RDPé‡å®šå‘â€

ä»è€Œåœ¨rdpä¸­ä½¿ç”¨æœ¬åœ°uç›˜

![image-20220602140717000](../../public/image/image-20220602140717000.png)

## å¤–éƒ¨è®¿é—®è®¾ç½®

è¿œç¨‹æ¡Œé¢è¿æ¥é»˜è®¤åªèƒ½åœ¨å±€åŸŸç½‘å†…ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦ç‰¹æ®Šé…ç½®ä»å¤–è¿æ¥

### IPv6

ç”±äºæ‹¥æœ‰å…¬ç½‘IPv6ï¼Œæ‰€ä»¥ä½¿ç”¨ç›¸å¯¹ç®€å•ï¼Œç»è¿‡é€‰æ‹©åå†³å®šä½¿ç”¨[ddns-go](https://github.com/jeessy2/ddns-go)å°†ipå›ºå®šåˆ°åŸŸå

å› ä¸ºæ˜¯Windowsï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨`ç³»ç»Ÿä¸­ä½¿ç”¨`çš„æ–¹æ¡ˆ

ä¸‹è½½å¹¶è§£å‹https://github.com/jeessy2/ddns-go/releases

åŒå‡»è¿è¡Œç¨‹åºå°†è‡ªåŠ¨æ‰“å¼€[http://127.0.0.1:9876](http://127.0.0.1:9876/)æŒ‡å¯¼é…ç½®

ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ`.\ddns-go.exe -s install`å¯ä»¥å°†ddns-goä½œä¸ºæœåŠ¡å®‰è£…

å› ä¸ºä½¿ç”¨çš„æ˜¯IPv6ï¼Œæ‰€ä»¥éœ€è¦åœ¨è®¾ç½®ç•Œé¢ä¸­æ‰“å¼€IPv6

é’‰é’‰æœºå™¨äººé…ç½®:

- é’‰é’‰ç”µè„‘ç«¯ -> ç¾¤è®¾ç½® -> æ™ºèƒ½ç¾¤åŠ©æ‰‹ -> æ·»åŠ æœºå™¨äºº -> è‡ªå®šä¹‰
- åªå‹¾é€‰ `è‡ªå®šä¹‰å…³é”®è¯`, è¾“å…¥çš„å…³é”®å­—å¿…é¡»åŒ…å«åœ¨RequestBodyçš„contentä¸­, å¦‚ï¼š`ä½ çš„å…¬ç½‘IPå˜äº†`
- URLä¸­è¾“å…¥é’‰é’‰ç»™ä½ çš„ `Webhookåœ°å€`
- RequestBodyä¸­è¾“å…¥ `{"msgtype": "markdown","markdown": {"title":"ä½ çš„å…¬ç½‘IPå˜äº†","text": "#### ä½ çš„å…¬ç½‘IPå˜äº† \n - IPV6åœ°å€ï¼š#{ipv6Addr} \n - åŸŸåæ›´æ–°ç»“æœï¼š#{ipv6Result} \n - åŸŸåç»“æœï¼š#{ipv6Domains} \n"}}`

### IPv4é…ç½®

å› ä¸ºæœ¬æ¥å°±æœ‰ä¸€å°æœåŠ¡å™¨ï¼ˆå†…ç½‘ç©¿é€è½¯ä»¶å¥½è´µğŸ˜­ï¼‰ï¼Œè€ƒè™‘ä¹‹åä½¿ç”¨è‡ªå»º[frp](https://github.com/fatedier/frp)

æœåŠ¡ç«¯ä½¿ç”¨Linux

```bash
wget https://github.com/fatedier/frp/releases/download/v0.43.0/frp_0.43.0_linux_amd64.tar.gz
tar -zxvf frp_0.43.0_linux_amd64.tar.gz
cd frp_0.43.0_linux_amd64/
mkdir -p /etc/frp
mv *.ini /etc/frp
mv frpc frps /usr/bin
```

æ–°å»º`/usr/lib/systemd/system/frps.service:`

```ini
[Unit]
Description=Frp Server Service
After=network.target

[Service]
Type=simple
User=nobody
Restart=on-failure
RestartSec=5s
ExecStart=/usr/bin/frps -c /etc/frp/frps.ini
LimitNOFILE=1048576

[Install]
WantedBy=multi-user.target
```

```bash
systemctl enable frps
systemctl start frps
```

> å®‰å…¨ç»„éœ€è¦åŒæ—¶æ”¾è¡Œ7000å’Œ4433ç«¯å£

å®¢æˆ·ç«¯ä½¿ç”¨windows

ä¸‹è½½å¹¶è§£å‹frp

frpc.ini

```ini
[common]
server_addr = 42.192.48.40
server_port = 7000

[rdp]
type = tcp
local_ip = 127.0.0.1
local_port = 3389
remote_port = 4433

[rdp_udp]
type = udp
local_ip = 127.0.0.1
local_port = 3389
remote_port = 4433
```

æµ‹è¯•æ— ç¢å

ä½¿ç”¨[winsw](https://github.com/winsw/winsw)å°†frpä½œä¸ºæœåŠ¡å¯åŠ¨

frpc.xml

```xml
<service>
    <id>frp</id>
    <name>frp</name>
    <description>frpc rdpæœåŠ¡</description>
    <executable>frpc</executable>
    <arguments>-c frpc.ini</arguments>
    <logmode>reset</logmode>
</service>
```

å°†`winsw.exe`ã€`frpc.xml`ã€`frpc.exe`ã€`frpc.ini`ç½®äºåŒä¸€ç›®å½•ä¸‹

```powershell
.\winsw install frpc.xml
```

è¿è¡Œ`services.msc`å³å¯çœ‹åˆ°ç›¸å…³æœåŠ¡ï¼Œå¯ä»¥è¿›è¡Œç™»å½•è´¦å·ç­‰è®¾ç½®

> å¦‚æœå‡ºç°rdpæ— æ³•è¿æ¥çš„æƒ…å†µï¼Œè¯·æ£€æŸ¥rdpæœåŠ¡æ˜¯å¦ä»åœ¨æ­£å¸¸è¿è¡Œ

## ç«¯å£ä¿®æ”¹

> ä¿®æ”¹ç«¯å£åéœ€è¦åŒæ—¶ä¿®æ”¹ä¸Šé¢çš„frpæœåŠ¡é…ç½®

å¯åœ¨`HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp`å¤„æ‰¾åˆ°ç«¯å£å¹¶ä¿®æ”¹

è¿è¡Œä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ç«¯å£

```powershell
Get-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "PortNumber"
```

è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†ç«¯å£ä¿®æ”¹ä¸º4433

```powershell
$portvalue = 4433

Set-ItemProperty -Path 'HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -name "PortNumber" -Value $portvalue 

New-NetFirewallRule -DisplayName 'RDPPORTLatest-TCP-In' -Profile 'Public' -Direction Inbound -Action Allow -Protocol TCP -LocalPort $portvalue 
New-NetFirewallRule -DisplayName 'RDPPORTLatest-UDP-In' -Profile 'Public' -Direction Inbound -Action Allow -Protocol UDP -LocalPort $portvalue
```

